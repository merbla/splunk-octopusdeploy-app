#Deployment by environment
sourcetype="octopus:deployment"
| rename Id as DeploymentId
| join EnvironmentId [ search sourcetype="octopus:environment" | rename Id as EnvironmentId, Name as EnvironmentName ]
| join ProjectId [ search sourcetype="octopus:project" | rename Id as ProjectId, Name as ProjectName ]
| timechart count(DeploymentId) by EnvironmentName


#Server Health Check
sourcetype="octopus:task" Name=Health

#Break Up of Deployment Machines
sourcetype="octopus:machine" | fields "Roles{}" | stats count by  "Roles{}"







sourcetype="octopus:deployment"
| rename Id as DeploymentId
| join EnvironmentId [ search sourcetype="octopus:environment" | rename Id as EnvironmentId ]
| join ProjectId [ search sourcetype="octopus:project" | rename Id as ProjectId ]


sourcetype="octopus:deployment"
| rename Id as DeploymentId
| join EnvironmentId [ search sourcetype="octopus:environment" | rename Id as EnvironmentId, Name as EnvironmentName ]
| join ProjectId [ search sourcetype="octopus:project" | rename Id as ProjectId, Name as ProjectName ]
| timechart count(DeploymentId) by EnvironmentName



sourcetype="octopus:deployment"
| rename Id as DeploymentId
| join EnvironmentId [ search sourcetype="octopus:environment" | rename Id as EnvironmentId, Name as EnvironmentName ]
| join ProjectId [ search sourcetype="octopus:project" | rename Id as ProjectId, Name as ProjectName ]
| join MachineId [ search sourcetype="octopus:machine" | rename Id as MachineId, Name as MachineName ]
| timechart count(DeploymentId) by EnvironmentName




#Deployments and releases

sourcetype="octopus:deployment" OR sourcetype="octopus:deployment"
| eval Hour = strftime(_time,"%H")
| rename Id as DeploymentId, TaskId as ServerTaskId
| fields timestamp, ReleaseId, DeploymentId, Name, EnvironmentId, ServerTaskId, ProjectId, Hour
| stats count(DeploymentId) as "Deployments" by  EnvironmentId, Hour
| table EnvironmentId Hour Deployments

sourcetype="octopus:environment" | rename Id as EnvironmentId | fields EnvironmentId Name


sourcetype="octopus:deployment" OR sourcetype="octopus:deployment"
| rename Id as DeploymentId, TaskId as ServerTaskId| fields timestamp, ReleaseId, DeploymentId, Name, EnvironmentId, ServerTaskId, ProjectId

sourcetype="octopus:deployment" OR sourcetype="octopus:deployment"
| rename Id as DeploymentId, TaskId as ServerTaskId | fields ReleaseId, DeploymentId, Name, EnvironmentId, ServerTaskId, ProjectId


sourcetype="octopus:deployment" OR sourcetype="octopus:deployment" OR sourcetype="octopus:task"  ReleaseId="releases-140"
| rename Id as DeploymentId



sourcetype="octopus:deployment" OR sourcetype="octopus:deployment"
| rename Id as DeploymentId
| fields timestamp, ReleaseId, DeploymentId, Name, EnvironmentId, Completed, StartTime, CompletedTime, QueueTime, IsCompleted

#Tasks
sourcetype="octopus:task" | rename Id as TaskId




#Server Health

source="octopus_deploy://Local Octopus Deploy" Name=Health
#Duration, Id, State, Health


sourcetype="octopus:task" Name=Health | timechart span=1d count by State
